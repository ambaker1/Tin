\documentclass{article}

% Input packages & formatting
\input{template/packages}
\input{template/formatting}
\renewcommand{\cleartooddpage}[1][]{\ignorespaces} % single side
\newcommand{\caret}{$^\wedge$}

% Other macros
\renewcommand{\^}[1]{\textsuperscript{#1}}
\renewcommand{\_}[1]{\textsubscript{#1}}

\title{\Huge Tin: A Tcl Package Manager\\\small Version 0.3}
\author{Alex Baker\\\small\url{https://github.com/ambaker1/Tin}}
\date{\small\today}
\begin{document}
\maketitle
\clearpage
\section{Installing Packages}
The command \cmdlink{tin install} installs packages directly from GitHub.
\begin{syntax}
\command{tin install} \$name <{}<-exact> \$version> <\$reqs ...>
\end{syntax}
\begin{args}
\$name & Package name. \\
-exact & Option to install exact version. \\
\$version & Package version. \\
\$reqs ... & Package version requirements, mutually exclusive with -exact option.
\end{args}

\begin{example}{Upgrading Tin}
\begin{lstlisting}
package require tin
tin install tin
\end{lstlisting}
\end{example}

The available packages in the Tin database can be queried with the command \cmdlink{tin packages}, and the versions for each package in ascending order can be queried with the command \cmdlink{tin versions}. If version requirements are specified in \cmdlink{tin versions}, it will filter using the rules of \textit{package vsatisfies}.

\begin{syntax}
\command{tin packages} <\$pattern>
\end{syntax}
\begin{args}
\$pattern & Optional ``glob'' pattern, default ``\texttt{*}'', or all packages.
\end{args}

\begin{syntax}
\command{tin versions} \$name <{}<-exact> \$version> <\$reqs ...>
\end{syntax}
\begin{args}
\$name & Package name. \\
-exact & Option to install exact version. \\
\$version & Package version. \\
\$reqs ... & Package version requirements, mutually exclusive with -exact option.
\end{args}

\clearpage
\section{Modifying the Tin Package Database}
The ``tinlist.tcl'' file in the Tin installation initializes the Tin database, which can be modified within your local instance of Tcl with the commands \cmdlink{tin add} and \cmdlink{tin remove}.

\begin{syntax}
\command{tin add} \$name \$version \$repo \$tag \$installer
\end{syntax}
\begin{args}
\$name & Package name. \\
\$version & Package version. \\
\$repo & Github repository URL. \\
\$tag & Github release tag for version. \\
\$installer & Installer file path in repo.
\end{args}

\begin{syntax}
\command{tin remove} \$name \$version ...
\end{syntax}
\begin{args}
\$name & Package name. \\
\$version ... & Package version(s) to remove.
\end{args}

\begin{example}{Adding a package to the Tin database}
\begin{lstlisting}
package require tin
tin add foo 1.0 https://github.com/username/foo v1.0 install_foo.tcl
\end{lstlisting}
\end{example}

\clearpage
\section{Loading and Importing Packages}
Tin also provides advanced tools for loading and importing packages.
The command \cmdlink{tin require} is similar to the Tcl command \textit{package require}, but with the added feature that if the package is missing, it will try to install it with \cmdlink{tin install}.
The command \cmdlink{tin import} additionally handles most use-cases of \textit{namespace import}. 
Both \cmdlink{tin require} and \cmdlink{tin import} return the version number of the package imported.
\begin{syntax}
\command{tin require} \$name <{}<-exact> \$version> <\$reqs ...>
\end{syntax}
\begin{args}
\$name & Package name. \\
-exact & Option to install exact version. \\
\$version & Package version. \\
\$reqs ... & Package version requirements, mutually exclusive with -exact option.
\end{args}
\begin{syntax}
\command{tin import} <-force> <\$patterns from> \$name <{}<-exact> \$version> <\$reqs ...> <as \$ns>
\end{syntax}
\begin{args}
-force & Option to overwrite existing commands. \\
\$patterns & Commands to import, or ``glob'' patterns, default ``\texttt{*}'', or all commands. \\
\$name & Package name. \\
-exact & Option to install exact version. \\
\$version & Package version. \\
\$reqs ... & Package version requirements, mutually exclusive with -exact option. \\
\$ns & Namespace to import into. Default global namespace, or ``\texttt{::}''.
\end{args}

\begin{example}{Importing all commands package ``foo''}
\begin{lstlisting}
package require tin
tin import foo 1.0
\end{lstlisting}
\end{example}

\clearpage
\section{Writing Installation Files}
Tin also provides utilities to simplify writing installation files.
The command \cmdlink{tin mkdir} creates a library directory to install a package in, relative to the base library directory (\cmdlink{tin library}).
The command \cmdlink{tin depend} checks if a package is installed without loading the package. 
If a package is not installed, it will try to install it with \cmdlink{tin install}.
\begin{syntax}
\command{tin mkdir} <-force> \$path
\end{syntax}
\begin{args}
-force & Option to create fresh library directory (deletes existing folder). \\
\$path & Relative path to \cmdlink{tin library}.
\end{args}
\begin{syntax}
\command{tin library} <\$path>
\end{syntax}
\begin{args}
\$path & Base library directory. Default returns the current base library directory. 
\end{args}
\begin{syntax}
\command{tin depend} \$name <{}<-exact> \$version> <\$reqs ...>
\end{syntax}
\begin{args}
\$name & Package name. \\
-exact & Option to install exact version. \\
\$version & Package version. \\
\$reqs ... & Package version requirements, mutually exclusive with -exact option. 
\end{args}

See the example installation file for a package ``foo'' that requires the package ``bar 1.2'':
\begin{example}{Example installation file ``install\textunderscore{}foo.tcl''}
\begin{lstlisting}
package require tin
tin depend bar 1.2
set dir [tin mkdir -force foo]
file copy README.md $dir
file copy LICENSE $dir
file copy lib/bar.tcl $dir
file copy lib/pkgIndex.pdf $dir
\end{lstlisting}
\end{example}
\end{document}

